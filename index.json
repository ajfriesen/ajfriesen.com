[{"authors":["admin"],"categories":null,"content":"I am living and working in Colgone (Germany) as a Systems Architect. At work I am creating high available infrastructure with technoligies like Kubernets, AWS, Terraform and a lot more.\nWhen not working I am using my free time to learn Golang which is powering all these awesome tools.\nYou can find me on several local (Cologne) Meetup groups:\n  Golang Colgone/Bonn  Kubernetes Meetup Cologne  Cologne AWS User Group #AWSUGCGN   Mid term career goal:\nI really like the context of infrastructure and automation. I am already using modern tools and the tools are more often written in Go. That is also my personal next objective, to learn Go and using the language in a professional way. Also I am really interested in working remote in a remote first company.\nIf you have something meeting this requirements feel free to contact me.\n  ","date":-62135596800,"expirydate":-62135596800,"kind":"taxonomy","lang":"en","lastmod":-62135596800,"objectID":"2525497d367e79493fd32b198b28f040","permalink":"https://www.ajfriesen.com/authors/admin/","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/authors/admin/","section":"authors","summary":"I am living and working in Colgone (Germany) as a Systems Architect. At work I am creating high available infrastructure with technoligies like Kubernets, AWS, Terraform and a lot more.\nWhen not working I am using my free time to learn Golang which is powering all these awesome tools.\nYou can find me on several local (Cologne) Meetup groups:\n  Golang Colgone/Bonn  Kubernetes Meetup Cologne  Cologne AWS User Group #AWSUGCGN   Mid term career goal:","tags":null,"title":"Andrej Friesen","type":"authors"},{"authors":null,"categories":null,"content":"I have worked with Kubernetes the last 2 years on AWS with Rancher2 and just want to jot down some notes. Kuberntes is not the only thing you need. It is a whole ecosystem of tools.\nI would have found this kind of ressource helpful when I started so maybe this will be to you.\nMy experience is based mostly on AWS and Rancher2 since at that time EKS was not around. So I will focus on the tools I know but maybe mention other alternatives.\nTopics I consider to write about:\n Rancher Helm nginx-ingress controller cert-manager kube2iam Grafana prometheus alertmanager cloudwatch-exporter fluentd-cloudwatch kube-state metrics metric-server Tools (kubens \u0026amp; kubectx) Docker  ","date":1586779200,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1586779200,"objectID":"4230dfaf9ccc0f3696361b4bf12ca014","permalink":"https://www.ajfriesen.com/project/notes-about-kubernetes-in-production/","publishdate":"2020-04-13T12:00:00Z","relpermalink":"/project/notes-about-kubernetes-in-production/","section":"project","summary":"Just a collection of notes and tools I have come across","tags":["Kubernetes","AWS","Rancher"],"title":"Notes about Kubernetes in Production","type":"project"},{"authors":["Andrej Friesen"],"categories":[],"content":"Table of Contents  Rancher rke - Rancher Kubernetes Engine Rancher2 Rancher vocabulary  Rancher Management Cluster and user cluster networking Cloud Credentials Node Templates Kubernetes Cluster with Node Pools   Rancher Terraform Provider RKE Terraform Provider   Rancher Rancher is a Kubernetes distribution build by Rancher Labs. There are some others like OpenShift from Red Hat with different features.\nThis distributions will run Kubernetes in a opinioated way so you do not have to think of ervery detail.\nExample:\nKubernetes does not come with a user mangement system. You could implement this your own or just pick a distribution which has done all the work for you. Rancher comes with different authentication providers like Github, Azure AD and others. It is baked in. Just configure the authentication in Rancher, OpenShift or your Kubernetes distribution of choice and that is it.\nSince it is opinioated it may not fit your usecase. Mayne you just need to dig a little deeper into the configuration options that depends on your needs.\nFeatures Rancher will give you:\n User management, since Kubernetes does not have user management backed in A neat webinterface to browse your clusters (yes, I mean several clusters!) Provision to major cloud providers (AWS, Google, Azure), bare metal, vmware vSphere etc. Kubernetes Cluster backups, upgrades, etc One place to manage a lot  Listing all features of Rancher does not make sense and I am not saying to use Rancher. I just want you to know, that all this is taken care of and that is the real reason to choose a Kubernetes distribution. This is basic and importand stuff which you would need to implement by yourself. Pick your flavour and go with it like Linux distributions ðŸ˜‰.\nrke - Rancher Kubernetes Engine Rancher2 is not the tool which creates the User Clusters. It is rke which will run in Rancher. Rancher is packed with a certain version of rke. If you just want a Kubernetes Cluster to play with you can use several tools like:\n  kops  kubeadm  kubicorn  minikube  rke (Rancher Kubernetes Engine)  rke is just another method to install and maintain you Kubernetes cluster in the rancher opinionated way. There are a lot of configuration options. Check the rancher rke docs for more information.\nrke will give you a kubernetes cluster to work with and not the rancher webinterface! This is somewhat confusing, when you just start.\nYou can always see which Rancher version uses which rke version and therefore the support of the kubernetes version in the rancher/rancher repo\nHere you can see that rancher v2.2.11 uses rke v0.2.10 and supports up to these kubernetres versoin:\n 1.13.12 1.14.10 1.15.11  A good overview for support and all the versions about rancher can be found in their docs: Rancher Support Matrix\nRancher2 Rancher itself is the Rancher API and Webinterface which you often see on the internet when someone is referring to rancher.\nRancher will run on top of your Kubernetes cluster created by rke. You can depoly rancher via helm to that first rke cluster you created.\nHere is the Rancher Helm Chart and the according documentation on the rancher website Install Rancher on the Kubernete Cluster\nSo now you have a Kubernets cluster with the rancher 2 helm chart deplyed on to. This Cluster should not be used as a Cluster for workloads. Since Rancher comes with rke you can now deploy as many cluster as you like to what location you like.\nRancher vocabulary Now you have your rancher management cluster running you are ready to go to create you clusters with your cloud provider of choice and which is supported.\nI will focus on AWS and on EC2 based clusters since that is what I have experience with. But this vocabulary is more or less the same for every other provider.\n   Word Description     rke rancher kubernetes engine. Tool to deploy a kubernetes cluster in the rancher way.   rancher Rancher API and Webinterface..   Cloud Credentials Credentials to your provider (AWS, Google, Azure, etc.).   Node Templates Definition of Node. Networking, Instance Type, Image, etc.   Node Pool Mapping between Node Role and Node Template when creating a User Cluster.   Node Role Worker, etcd and Control Plane roles for Kubernetes   User Cluster The Cluster created for your actual workload     Rancher Management Cluster and user cluster networking Rancher will not take care of your general AWS infrastrucutre like netoworking. This needs to be taken care of by yourself. I would recommend to go with terraform but AWS Cloudformation and the AWS Console will work as well.\nThe rancher management cluster is running in a VPC. The cluster you want to create needs another VPC. That is something you have to take care of by yourself. Rancher will not create the networking for you.\nYou can create the requirement network infrastructure with the AWS Console but I would recommend to go with AWS Cloudformation or terraform.\nWhat you need:\n VPC for rancher mangement cluster VPC for rancher created kubernetes cluster VPC peering between those 2 VPS  Why do you need the peering? Rancher will ssh into each node and will do the provisioning for each Kubernetes node. Also the created Kubernetes cluster will ping back to rancher for health checks.\nCloud Credentials Cloud Credentials is just an AWS Access Key and Access Secret.\nDo not use your user bound AWS credentials!\nWhat will happen, when you deploy your Kubernetes Cluster with the credials from a user and they leave the company?\n You will deactiavate the aws account because of offboarding Suddenly the cluster does not have proper credentials to interact with the AWS API anymore Finding out will take you some time and can have bad effects like nodes not comming up in AWS  Why do I know that? It is called experience ;-)\nNode Templates Node Templates are just what it says. You define values like:\n VPC subnet EC2 instance type AMI ssh user etc.  As you can see you need a Node Template for every availability zone since subnet in a AWS VPC are bound to an availabilty zone.\nYou also can use different EC2 instance types for Kubernetes Worker and etc and controleplane.\nIf you are testing out the provisioning and you encounter error, check that the instnace itself is not too small. That happend to me and I could not figure out what was wrong. Increasing the EC2 instance type to a more performant machine did resolve that issue.\nKubernetes Cluster with Node Pools A Kubernetes cluster in Rancher is made of Node Pools. The Node Pool is just a mapping between the Node Templates and the role in the cluster.\nThe role can be one of the following:\n Worker (will run you workload) etcd (Database for Kubernetes) control Plane (Kubernetes API)  Then you can configure the cluster itself with the right Cloud Provider. This will allow you to use the serviceType LoadBalancer and AWS or other vendors will spawn a LoadBalancer for your particular service.\nAlso you can confiugre your network driver, snapshots and much more\nRancher Terraform Provider Rancher Labs is also providing an official Rancher2 Terraform Provider. You can create most resources specific to Rancher with that provider. Now you can automate everything with terraform. From creating the network in AWS up to the cluster in Rancher.\nRancher2 Terraform Provider on the Terraform Website:\nhttps://www.terraform.io/docs/providers/rancher2/index.html\nRancher2 terraform Provider source at github :\nhttps://github.com/terraform-providers/terraform-provider-rancher2\nRKE Terraform Provider There was a terraform provider made by Kazumichi Yamamoto which I have used in version v0.14.1 to automate the creation of the rancher management cluster. But I think Rancher has taken over development of that project and the repository moved to the rancher organization.\nhttps://github.com/rancher/terraform-provider-rke\nRancher Labs is pretty fast in developing this tools. It will take some time and then the terraform rke provider will move to the offical terraform providers organization.\nUntil then you have to download the provider by yourself at rancher(terraform-provider-rke. Only offical hasicorp provders listed here in the terraform-providers github organization will be downloaded for you when running terraform init.\n","date":1586774804,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1586774804,"objectID":"a518db00a9b347463c84a1f162af961a","permalink":"https://www.ajfriesen.com/post/rancher-overview/","publishdate":"2020-04-13T12:46:44+02:00","relpermalink":"/post/rancher-overview/","section":"post","summary":"Table of Contents  Rancher rke - Rancher Kubernetes Engine Rancher2 Rancher vocabulary  Rancher Management Cluster and user cluster networking Cloud Credentials Node Templates Kubernetes Cluster with Node Pools   Rancher Terraform Provider RKE Terraform Provider   Rancher Rancher is a Kubernetes distribution build by Rancher Labs. There are some others like OpenShift from Red Hat with different features.\nThis distributions will run Kubernetes in a opinioated way so you do not have to think of ervery detail.","tags":["kubernetes","rancher","aws","terraform"],"title":"Rancher Overview","type":"post"},{"authors":["Andrej Friesen"],"categories":[],"content":"I am running arch linux on my server with LUKS disc encryption. I do need to type in my password every time I reboot the machine. Sometimes I have a typo and this happens:\nWelcome to GRUB! Attempting to decrypt master key... Enter passphrase for hd1,gpt2 (\u0026lt;disk uuid\u0026gt;): error: access denied error: no such cryptodisk found. error: disk `cryptouuid/\u0026lt;disk uuid\u0026gt;` not found. Entering rescue mode...  Since with IPMI I do not need to attach a VGA cable and keyboard to my server but still the grub rescue console is something I am not familiar with and need to deal with.\nYou can mount the partition with cryptomount:1\ncryptomount (hd1,gpt2)  Enter your password.\nThen load the module for a normal boot\ninsmod normal  Boot:\nnormal  Now you shoul get forwarded to the grub boot manager as you typed the password correct the first time.\n   cryptomount \u0026#x21a9;\u0026#xfe0e;\n   ","date":1586733975,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1586733975,"objectID":"5e0d1067bde41ef0e75c13f469282e48","permalink":"https://www.ajfriesen.com/post/decrypt-and-mount-luks-volume-in-grub-rescue-mode/","publishdate":"2020-04-13T01:26:15+02:00","relpermalink":"/post/decrypt-and-mount-luks-volume-in-grub-rescue-mode/","section":"post","summary":"I am running arch linux on my server with LUKS disc encryption. I do need to type in my password every time I reboot the machine. Sometimes I have a typo and this happens:\nWelcome to GRUB! Attempting to decrypt master key... Enter passphrase for hd1,gpt2 (\u0026lt;disk uuid\u0026gt;): error: access denied error: no such cryptodisk found. error: disk `cryptouuid/\u0026lt;disk uuid\u0026gt;` not found. Entering rescue mode...  Since with IPMI I do not need to attach a VGA cable and keyboard to my server but still the grub rescue console is something I am not familiar with and need to deal with.","tags":["grub","luks"],"title":"Decrypt and Mount LUKS Volume in Grub Rescue Mode","type":"post"}]